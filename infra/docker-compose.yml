version: "3.9"
services:
  backend:
    build:
      context: ..
      dockerfile: infra/Dockerfile
    working_dir: /app/backend
    environment:
      - PORT=4000
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - RPC_URL=${RPC_URL:-http://hardhat:8545}
      - FACTORY_ADDRESS=${FACTORY_ADDRESS}
    ports:
      - "4000:4000"
    depends_on:
      - hardhat
  frontend:
    image: node:20-alpine
    working_dir: /app/frontend
    volumes:
      - ../frontend:/app/frontend
    command: sh -c "npm install && npm run dev"
    environment:
      - NEXT_PUBLIC_BACKEND_URL=http://localhost:4000
    ports:
      - "3000:3000"
    depends_on:
      - backend
  hardhat:
    image: node:20-alpine
    working_dir: /app/contracts
    volumes:
      - ../contracts:/app/contracts
    command: sh -c "npm install && npx hardhat node --hostname 0.0.0.0"
    ports:
      - "8545:8545"
